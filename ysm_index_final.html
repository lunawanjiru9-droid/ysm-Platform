<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YSM - YouTube Subs Monetization</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    
    <style>
        :root {
            --primary-red: #E50914;
            --dark-red: #b80710;
            --black: #000000;
            --dark-gray: #0a0a0a;
            --medium-gray: #1a1a1a;
            --light-gray: #333333;
            --white: #ffffff;
            --success: #00ff00;
            --warning: #ffa500;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--black);
            color: var(--white);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Glassmorphism Effect */
        .glassmorphism {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
        }

        .smooth-3d {
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .btn-3d {
            transform: translateZ(20px);
            transition: all 0.3s ease;
        }

        .btn-3d:hover {
            transform: translateZ(30px) translateY(-5px);
            box-shadow: 0 15px 30px rgba(229, 9, 20, 0.4);
        }

        header {
            background: var(--black);
            padding: 15px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--glass-border);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--dark-red) 100%);
            color: var(--white);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(229, 9, 20, 0.4);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--white);
            border: 2px solid var(--white);
        }

        .btn-success { background-color: var(--success); color: var(--black); }
        .btn-warning { background-color: var(--warning); color: var(--black); }
        .btn-danger { background-color: var(--primary-red); color: var(--white); }

        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .badge-pending { background: var(--warning); color: var(--black); }
        .badge-approved { background: var(--success); color: var(--black); }
        .badge-rejected { background: var(--primary-red); color: var(--white); }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid var(--light-gray);
            border-top: 4px solid var(--primary-red);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .form-container {
            max-width: 500px;
            margin: 100px auto;
            padding: 40px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--glass-border);
        }

        .form-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-red);
            font-size: 2rem;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-control {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            background-color: var(--black);
            color: var(--white);
            font-size: 1rem;
        }

        .page {
            display: none;
        }

        .active {
            display: block;
        }

        .dashboard {
            min-height: 100vh;
            padding-top: 80px;
            padding-bottom: 70px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--black);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            border-bottom: 1px solid var(--glass-border);
        }

        .wallet-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            padding: 25px;
            border-radius: 15px;
            margin: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
        }

        .wallet-balance {
            font-size: 3rem;
            font-weight: bold;
            color: var(--success);
            margin: 15px 0;
        }

        .bottom-nav {
            display: flex;
            justify-content: space-around;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--dark-gray);
            padding: 12px 0;
            border-top: 1px solid var(--glass-border);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--light-gray);
            text-decoration: none;
            font-size: 0.9rem;
        }

        .nav-item.active {
            color: var(--primary-red);
        }

        .admin-access {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: transparent;
            border: none;
            color: transparent;
            width: 50px;
            height: 50px;
            cursor: pointer;
            z-index: 1000;
        }

        .pin-input {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 1.5rem;
            margin: 0 5px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            background: var(--black);
            color: var(--white);
        }

        .pin-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        /* Admin Styles */
        .admin-panel {
            padding: 20px;
            margin-top: 80px;
        }

        .admin-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .admin-nav button {
            padding: 10px 20px;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .admin-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid var(--glass-border);
        }

        .user-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        .balance-control {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .balance-input {
            width: 100px;
            padding: 8px;
            border: 1px solid var(--light-gray);
            border-radius: 5px;
            background: var(--black);
            color: var(--white);
        }

        /* File Upload Styles */
        .file-upload {
            border: 2px dashed var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: var(--primary-red);
        }

        .file-name {
            font-size: 0.9rem;
            color: var(--light-gray);
            margin-top: 10px;
        }

        /* Task Video Styles */
        .task-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            margin: 15px;
            border: 1px solid var(--glass-border);
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 300px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .task-timer {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .subscribe-btn {
            width: 100%;
            padding: 15px;
            background: var(--primary-red);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .subscribe-btn:disabled {
            background: var(--light-gray);
            cursor: not-allowed;
        }

        .subscribe-btn:not(:disabled):hover {
            background: var(--dark-red);
            transform: translateY(-2px);
        }

        /* Tier Table Styles */
        .tier-table {
            width: 100%;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid var(--glass-border);
        }

        .tier-table th {
            background: var(--primary-red);
            padding: 15px;
            text-align: left;
        }

        .tier-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        .tier-table tr:hover {
            background: var(--glass-bg);
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            background: var(--light-gray);
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 10px;
            background: linear-gradient(90deg, var(--primary-red), var(--success));
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        /* Marketing Sections */
        .marketing-section {
            padding: 80px 0;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .feature-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .testimonial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .testimonial-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid var(--glass-border);
        }

        .testimonial-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-red);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        /* Payment Methods */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .payment-method {
            background: var(--glass-bg);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .payment-method.selected {
            border-color: var(--primary-red);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }
            
            .wallet-card {
                margin: 10px;
            }
            
            .tier-table {
                font-size: 0.8rem;
            }
            
            .video-container {
                height: 200px;
            }
            
            .feature-grid, .testimonial-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-nav {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

<!-- Loader -->
<style>
#loader-wrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;background:#fff;z-index:99999;transition:opacity 1.5s ease}
.play-icon{width:96px;height:96px;display:flex;align-items:center;justify-content:center}
.play-icon svg{width:64px;height:64px;fill:#FF0000}
.loader-bar{width:240px;height:6px;background:rgba(0,0,0,0.08);border-radius:6px;margin-top:18px;overflow:hidden;position:relative}
.loader-progress{position:absolute;left:0;height:100%;background:#FF0000;transition:width 0.2s linear}
</style>
<div id="loader-wrap">
  <div class="play-icon"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 22V2l18 10L3 22z"></path></svg></div>
  <div class="loader-bar"><div id="loader-progress" class="loader-progress" style="width:0%"></div></div>
</div>
<script>
(function(){
  const loader = document.getElementById('loader-wrap'); const prog = document.getElementById('loader-progress');
  if(!loader || !prog) return;
  let progress=0, iv=null;
  function update(p){ const clamped=Math.max(0,Math.min(100,p)); prog.style.width=clamped+'%'; }
  function finish(){ if(iv) clearInterval(iv); loader.style.opacity='0'; setTimeout(()=>{ loader.style.display='none'; },1500); }
  iv = setInterval(()=>{ if(progress<60) progress+=Math.random()*2+0.6; else progress+=Math.random()*3+1; update(progress); if(progress>=100) finish(); },120);
  setTimeout(()=>{ if(typeof firebase!=='undefined' && firebase.auth){ finish(); } },3000);
  setTimeout(()=>{ if(progress<100) finish(); },8000);
})();
</script>

    <!-- Loading Spinner -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Processing...</p>
    </div>

    <!-- Hidden Admin Access -->
    <button class="admin-access" onclick="showPage('admin-login-page')" title="Admin Access"></button>

    <!-- Landing Page -->
    <div id="landing-page" class="page active">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fab fa-youtube"></i> YSM
                    </div>
                    <div class="auth-buttons">
                        <button class="btn btn-outline" onclick="showPage('login-page')">Login</button>
                        <button class="btn btn-primary" onclick="showPage('register-page')">Join YSM</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section style="background: linear-gradient(135deg, var(--black) 0%, var(--primary-red) 100%); padding: 180px 0 100px; text-align: center;">
            <div class="container">
                <h1 style="font-size: 3.5rem; margin-bottom: 25px;">üåç Welcome to YSM ‚Äî Where Attention Becomes Wealth</h1>
                <p style="font-size: 1.3rem; max-width: 800px; margin: 0 auto 30px;">
                    In the digital world, attention is the new currency. Every like, every view, every click has value ‚Äî but for years, that value has only flowed in one direction: away from the users who create it. YSM (YouTube Subs Monetization) was built to change that.
                </p>
                <div class="auth-buttons">
                    <button class="btn btn-primary btn-3d" style="font-size: 1.2rem; padding: 15px 35px;" onclick="showPage('register-page')">
                        Join YSM Now
                    </button>
                    <button class="btn btn-outline btn-3d" style="font-size: 1.2rem; padding: 15px 35px;" onclick="showPage('login-page')">
                        Log In to Start Earning
                    </button>
                </div>
            </div>
        </section>

        <!-- How It Works -->
        <section class="marketing-section" style="background: var(--dark-gray);">
            <div class="container">
                <h2 style="text-align: center; font-size: 2.5rem; margin-bottom: 30px;">üíº How It Works ‚Äî Partnership, Not Payment</h2>
                <p style="text-align: center; font-size: 1.2rem; max-width: 900px; margin: 0 auto 40px;">
                    Every activation tier represents your digital partnership level in the YSM ecosystem. Your contribution helps power sponsored ad campaigns, influencer collaborations, and marketing operations that feed our global reward pool. As the system grows, so does your share of the flow. Each task you complete helps boost platform engagement, attract new sponsors, and increase your potential rewards.
                </p>
                <p style="text-align: center; font-size: 1.2rem; max-width: 900px; margin: 0 auto 40px; color: var(--primary-red); font-weight: bold;">
                    üí° Think of it as turning your time online into a growing digital asset.
                </p>
                <div class="feature-grid">
                    <div class="feature-card smooth-3d">
                        <div class="feature-icon">üìù</div>
                        <h3 style="margin-bottom: 15px;">1. Register</h3>
                        <p>Create your account in seconds with our secure registration process</p>
                    </div>
                    <div class="feature-card smooth-3d">
                        <div class="feature-icon">üîí</div>
                        <h3 style="margin-bottom: 15px;">2. Complete KYC</h3>
                        <p>Verify your identity with our secure and fast KYC process</p>
                    </div>
                    <div class="feature-card smooth-3d">
                        <div class="feature-icon">üí∞</div>
                        <h3 style="margin-bottom: 15px;">3. Watch & Earn</h3>
                        <p>Get paid for watching sponsored YouTube videos and subscribing</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Growth by Design -->
        <section class="marketing-section" style="background: var(--black);">
            <div class="container">
                <h2 style="text-align: center; font-size: 2.5rem; margin-bottom: 50px;">üìà Growth by Design</h2>
                <div class="feature-grid">
                    <div class="feature-card smooth-3d">
                        <div class="feature-icon">üïí</div>
                        <h3 style="margin-bottom: 15px;">Daily Rewards</h3>
                        <p>Earn by completing simple video-based tasks</p>
                    </div>
                    <div class="feature-card smooth-3d">
                        <div class="feature-icon">üîù</div>
                        <h3 style="margin-bottom: 15px;">Tier Levels</h3>
                        <p>Choose your earning tier ‚Äî from Starter to Elite ‚Äî and scale as your returns grow</p>
                    </div>
                    <div class="feature-card smooth-3d">
                        <div class="feature-icon">üí∞</div>
                        <h3 style="margin-bottom: 15px;">Compound Growth</h3>
                        <p>Each month's performance builds on the last, unlocking greater long-term returns</p>
                    </div>
                    <div class="feature-card smooth-3d">
                        <div class="feature-icon">üåê</div>
                        <h3 style="margin-bottom: 15px;">Community Ecosystem</h3>
                        <p>Your success contributes to platform growth ‚Äî meaning more users, more campaigns, more revenue</p>
                    </div>
                </div>
                <p style="text-align: center; font-size: 1.2rem; max-width: 900px; margin: 40px auto 0; color: var(--primary-red); font-weight: bold;">
                    ‚ú® You're not just a user. You're part of the system that fuels itself.
                </p>
            </div>
        </section>

        <!-- The Vision -->
        <section class="marketing-section" style="background: var(--dark-gray);">
            <div class="container">
                <h2 style="text-align: center; font-size: 2.5rem; margin-bottom: 30px;">üöÄ The Vision ‚Äî Millions United by Growth</h2>
                <p style="text-align: center; font-size: 1.2rem; max-width: 900px; margin: 0 auto 30px;">
                    Our goal is to empower over 1 million digital partners who earn, grow, and evolve together. We're not building another "task app" ‚Äî we're creating a digital wealth ecosystem that rewards participation, not speculation.
                </p>
                <p style="text-align: center; font-size: 1.2rem; max-width: 900px; margin: 0 auto 30px; font-weight: bold;">
                    Every action matters. Every view counts. Every day adds up.
                </p>
                <p style="text-align: center; font-size: 1.2rem; max-width: 900px; margin: 30px auto 0; color: var(--primary-red); font-style: italic;">
                    üí¨ "The future doesn't belong to those who work harder ‚Äî it belongs to those who work smarter."
                </p>
            </div>
        </section>

        <!-- Success Stories -->
        <section class="marketing-section" style="background: var(--black);">
            <div class="container">
                <h2 style="text-align: center; font-size: 2.5rem; margin-bottom: 50px;">üåü Success Stories</h2>
                <div class="testimonial-grid">
                    <div class="testimonial-card">
                        <div class="testimonial-avatar">JD</div>
                        <h3 style="margin-bottom: 10px;">John D. - New York</h3>
                        <p style="color: var(--success); margin-bottom: 10px;">Earned $1,250 in 3 months</p>
                        <p>"I was skeptical at first, but YSM has completely changed how I earn online. The platform is easy to use and payments are always on time. I've upgraded to the $769.23 tier and my earnings have tripled!"</p>
                    </div>
                    <div class="testimonial-card">
                        <div class="testimonial-avatar">SM</div>
                        <h3 style="margin-bottom: 10px;">Sarah M. - London</h3>
                        <p style="color: var(--success); margin-bottom: 10px;">Earned $2,800 in 6 months</p>
                        <p>"As a student, YSM has been a game-changer. I can earn while studying. The tier system really works! I started with the basic tier and now I'm at the $1,692.31 level. The compound growth is incredible."</p>
                    </div>
                    <div class="testimonial-card">
                        <div class="testimonial-avatar">RK</div>
                        <h3 style="margin-bottom: 10px;">Robert K. - Nairobi</h3>
                        <p style="color: var(--success); margin-bottom: 10px;">Earned $5,100 in 1 year</p>
                        <p>"The referral program is amazing. I've built a team of 15 people and earn passive income from their activities. YSM has given me financial freedom I never thought possible."</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tier Table -->
        <section class="marketing-section" style="background: var(--dark-gray);">
            <div class="container">
                <h2 style="text-align: center; font-size: 2.5rem; margin-bottom: 50px;">Investment Tiers</h2>
                <div class="tier-table-container" style="overflow-x: auto;">
                    <table class="tier-table">
                        <thead>
                            <tr>
                                <th>Tier</th>
                                <th>Ads/Day</th>
                                <th>Pay/Ad</th>
                                <th>Daily</th>
                                <th>Monthly</th>
                                <th>6-Month</th>
                                <th>1-Year</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>$115.38</td><td>8</td><td>$0.48</td><td>$3.85</td><td>$115.38</td><td>$692.31</td><td>$1,384.62</td></tr>
                            <tr><td>$192.31</td><td>10</td><td>$0.64</td><td>$6.41</td><td>$192.31</td><td>$1,153.85</td><td>$2,307.69</td></tr>
                            <tr><td>$269.23</td><td>12</td><td>$0.75</td><td>$8.97</td><td>$269.23</td><td>$1,615.38</td><td>$3,230.77</td></tr>
                            <tr><td>$307.69</td><td>13</td><td>$0.79</td><td>$10.26</td><td>$307.69</td><td>$1,846.15</td><td>$3,692.31</td></tr>
                            <tr><td>$461.54</td><td>15</td><td>$1.03</td><td>$15.38</td><td>$461.54</td><td>$2,769.23</td><td>$5,538.46</td></tr>
                            <tr><td>$615.38</td><td>17</td><td>$1.21</td><td>$20.51</td><td>$615.38</td><td>$3,692.31</td><td>$7,384.62</td></tr>
                            <tr><td>$769.23</td><td>18</td><td>$1.43</td><td>$25.64</td><td>$769.23</td><td>$4,615.38</td><td>$9,230.77</td></tr>
                            <tr><td>$923.08</td><td>20</td><td>$1.54</td><td>$30.77</td><td>$923.08</td><td>$5,538.46</td><td>$11,076.92</td></tr>
                            <tr><td>$1,692.31</td><td>25</td><td>$2.26</td><td>$56.41</td><td>$1,692.31</td><td>$10,153.85</td><td>$20,307.69</td></tr>
                            <tr><td>$2,461.54</td><td>30</td><td>$2.74</td><td>$82.05</td><td>$2,461.54</td><td>$14,769.23</td><td>$29,538.46</td></tr>
                            <tr><td>$3,230.77</td><td>35</td><td>$3.08</td><td>$107.69</td><td>$3,230.77</td><td>$19,384.62</td><td>$38,769.23</td></tr>
                            <tr><td>$4,000.00</td><td>40</td><td>$3.33</td><td>$133.33</td><td>$4,000.00</td><td>$24,000.00</td><td>$48,000.00</td></tr>
                            <tr><td>$4,615.38</td><td>45</td><td>$3.42</td><td>$153.85</td><td>$4,615.38</td><td>$27,692.31</td><td>$55,384.62</td></tr>
                        </tbody>
                    </table>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary btn-3d" onclick="showPage('register-page')">Start Earning Now</button>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer style="background: var(--black); padding: 40px 0; border-top: 1px solid var(--glass-border);">
            <div class="container">
                <div style="text-align: center;">
                    <p>&copy; 2024 YSM - YouTube Subs Monetization. All rights reserved.</p>
                    <div style="margin-top: 20px;">
                        <a href="#" style="color: var(--white); margin: 0 10px;">Terms</a>
                        <a href="#" style="color: var(--white); margin: 0 10px;">Privacy</a>
                        <a href="#" style="color: var(--white); margin: 0 10px;">Contact</a>
                        <a href="#" style="color: var(--white); margin: 0 10px;">Support</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Registration Page -->
    <div id="register-page" class="page form-container">
        <h2 class="form-title">Join YSM</h2>
        <div class="form-group">
            <input type="text" class="form-control" id="reg-name" placeholder="Full Name" required>
        </div>
        <div class="form-group">
            <input type="email" class="form-control" id="reg-email" placeholder="Email Address" required>
        </div>
        <div class="form-group">
            <input type="tel" class="form-control" id="reg-phone" placeholder="Phone Number" required>
        </div>
        <div class="form-group">
            <select class="form-control" id="reg-country" required>
                <option value="">Select Country</option>
                <option value="us">United States</option>
                <option value="uk">United Kingdom</option>
                <option value="ke">Kenya</option>
                <option value="ng">Nigeria</option>
                <option value="za">South Africa</option>
                <option value="in">India</option>
            </select>
        </div>
        <div class="form-group">
            <input type="password" class="form-control" id="reg-password" placeholder="Create Password" required>
        </div>
        <button class="btn btn-primary btn-3d" style="width: 100%;" onclick="registerUser()">Create Account</button>
        <p style="text-align: center; margin-top: 20px;">
            <a href="#" style="color: var(--primary-red);" onclick="showPage('landing-page')">‚Üê Back to Home</a>
        </p>
    </div>

    <!-- OTP Verification Page -->
    <div id="otp-verification-page" class="page form-container">
        <h2 class="form-title">Verify Your Account</h2>
        <p style="text-align: center; margin-bottom: 25px;">We've sent a verification code to your email</p>
        <div class="form-group">
            <input type="text" class="form-control" id="sms-otp" placeholder="SMS OTP Code" required>
        </div>
        <button class="btn btn-primary btn-3d" style="width: 100%;" onclick="verifyOTP()">Verify & Continue</button>
        <p style="text-align: center; margin-top: 20px;">
            <a href="#" style="color: var(--primary-red);" onclick="resendOTP()">Resend Codes</a>
        </p>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="page form-container">
        <h2 class="form-title">User Login</h2>
        <div class="form-group">
            <input type="email" class="form-control" id="login-email" placeholder="Email Address" required>
        </div>
        <div class="form-group">
            <input type="password" class="form-control" id="login-password" placeholder="Password" required>
        </div>
        <button class="btn btn-primary btn-3d" style="width: 100%;" onclick="loginUser()">Login</button>
        <p style="text-align: center; margin-top: 20px;">
            <a href="#" style="color: var(--primary-red);" onclick="showPage('landing-page')">‚Üê Back to Home</a>
        </p>
    </div>

    <!-- KYC Page -->
    <div id="kyc-page" class="page form-container">
        <h2 class="form-title">KYC Verification - REQUIRED</h2>
        <p style="text-align: center; margin-bottom: 25px; color: var(--warning);">
            All documents are required for verification before you can earn or withdraw
        </p>
        
        <div class="form-group">
            <input type="text" class="form-control" id="kyc-name" placeholder="Full Name" required>
        </div>
        
        <div class="form-group">
            <select class="form-control" id="kyc-id-type" required>
                <option value="">Select ID Type</option>
                <option value="passport">Passport</option>
                <option value="national_id">National ID</option>
                <option value="driving_license">Driving License</option>
            </select>
        </div>
        
        <div class="form-group">
            <input type="text" class="form-control" id="kyc-id-number" placeholder="ID Number" required>
        </div>

        <!-- File Uploads -->
        <div class="form-group">
            <label>ID Front Image *</label>
            <div class="file-upload" onclick="document.getElementById('kyc-front').click()">
                <i class="fas fa-upload" style="font-size: 2rem; margin-bottom: 10px;"></i>
                <p>Click to upload ID Front</p>
                <input type="file" id="kyc-front" style="display: none;" accept="image/*" required>
                <div id="front-file-name" class="file-name">No file chosen</div>
            </div>
        </div>

        <div class="form-group">
            <label>ID Back Image *</label>
            <div class="file-upload" onclick="document.getElementById('kyc-back').click()">
                <i class="fas fa-upload" style="font-size: 2rem; margin-bottom: 10px;"></i>
                <p>Click to upload ID Back</p>
                <input type="file" id="kyc-back" style="display: none;" accept="image/*" required>
                <div id="back-file-name" class="file-name">No file chosen</div>
            </div>
        </div>

        <div class="form-group">
            <label>Selfie with ID *</label>
            <div class="file-upload" onclick="document.getElementById('kyc-selfie').click()">
                <i class="fas fa-camera" style="font-size: 2rem; margin-bottom: 10px;"></i>
                <p>Click to upload Selfie with ID</p>
                <input type="file" id="kyc-selfie" style="display: none;" accept="image/*" required>
                <div id="selfie-file-name" class="file-name">No file chosen</div>
            </div>
        </div>

        <div class="form-group">
            <label>Proof of Address *</label>
            <div class="file-upload" onclick="document.getElementById('kyc-address').click()">
                <i class="fas fa-home" style="font-size: 2rem; margin-bottom: 10px;"></i>
                <p>Click to upload Proof of Address</p>
                <input type="file" id="kyc-address" style="display: none;" accept="image/*" required>
                <div id="address-file-name" class="file-name">No file chosen</div>
            </div>
        </div>

        <button class="btn btn-primary btn-3d" style="width: 100%;" onclick="submitKYC()">Submit KYC Verification</button>
    </div>

    <!-- KYC Pending Page -->
    <div id="kyc-pending-page" class="page form-container">
        <div style="text-align: center; padding: 40px;">
            <div class="glassmorphism" style="padding: 30px; border-radius: 15px; margin: 20px 0;">
                <h2>üïí KYC Verification Pending</h2>
                <p>Your documents are under review by our admin team.</p>
                <div class="badge badge-pending" style="margin-top: 15px;">Under Review</div>
            </div>
            <p style="margin-top: 20px; color: var(--light-gray);">
                You will gain full access once your KYC is approved. This usually takes 24-48 hours.
            </p>
            <button class="btn btn-outline" style="margin-top: 20px;" onclick="logout()">Logout</button>
        </div>
    </div>

    <!-- User Dashboard -->
    <div id="user-dashboard" class="page dashboard">
        <div class="top-bar">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div id="user-avatar" class="glassmorphism" style="width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.1rem;">U</div>
                <div>
                    <div id="user-display-name" style="font-weight: bold;">User</div>
                    <div style="font-size: 0.8rem; color: var(--light-gray);">
                        <span id="user-tier-display">Tier</span> ‚Ä¢ 
                        <span id="kyc-status" class="badge badge-pending">KYC</span>
                    </div>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-outline" style="padding: 8px 12px;" onclick="toggleNotifications()">
                    <i class="fas fa-bell"></i>
                </button>
                <button class="btn btn-outline" style="padding: 8px 12px;" onclick="toggleChat()">
                    <i class="fas fa-comment"></i>
                </button>
                <button class="btn btn-outline" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="dashboard-content" id="dashboard-home">
            <!-- Wallet Summary -->
            <div class="wallet-card">
                <h3>üí∞ Your YSM Wallet</h3>
                <div class="wallet-balance" id="user-balance">$0.00</div>
                <div style="display: flex; justify-content: space-between; margin: 15px 0;">
                    <div>
                        <div style="font-size: 0.9rem; color: var(--light-gray);">Pending</div>
                        <div style="font-weight: bold;" id="user-pending">$0.00</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9rem; color: var(--light-gray);">Referral Earnings</div>
                        <div style="font-weight: bold;" id="user-referral">$0.00</div>
                    </div>
                </div>
                
                <!-- Daily Progress -->
                <div style="margin: 20px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Daily Progress</span>
                        <span id="daily-progress-text">0/0</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="daily-progress-bar" style="width: 0%"></div>
                    </div>
                </div>

                <button class="btn btn-primary btn-3d" style="width: 100%; margin-top: 20px; padding: 15px;" onclick="showWithdrawModal()">
                    Request Withdrawal
                </button>
            </div>

            <!-- Referral Panel -->
            <div class="wallet-card">
                <h3>üë• Referral Program</h3>
                <div class="form-group">
                    <label>Your Referral Link</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" class="form-control" id="referral-link" readonly>
                        <button class="btn btn-primary" onclick="copyReferralLink()">Copy</button>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                    <div class="glassmorphism" style="padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold;" id="referral-count">0</div>
                        <div style="font-size: 0.9rem;">Total Referrals</div>
                    </div>
                    <div class="glassmorphism" style="padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold;" id="referral-earnings">$0</div>
                        <div style="font-size: 0.9rem;">Total Earnings</div>
                    </div>
                </div>
            </div>

            <!-- Notifications -->
            <div class="wallet-card" id="notifications-panel" style="display: none;">
                <h3>üì¢ Notifications</h3>
                <div id="notifications-list">
                    <div class="user-item">
                        <div>
                            <div style="font-weight: bold;">Welcome to YSM!</div>
                            <div style="font-size: 0.9rem; color: var(--light-gray);">
                                Start earning by completing tasks below
                            </div>
                        </div>
                        <div style="font-size: 0.8rem; color: var(--light-gray);">Just now</div>
                    </div>
                </div>
            </div>

            <!-- Tasks Section -->
            <div style="padding: 20px;">
                <h3 style="margin-bottom: 20px;">üé¨ Available Tasks</h3>
                <div id="tasks-container">
                    <!-- Tasks will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Tasks Page -->
        <div class="dashboard-content" id="dashboard-tasks" style="display: none;">
            <div style="padding: 20px;">
                <h3 style="margin-bottom: 20px;">üìã Your Tasks</h3>
                <div id="tasks-page-container">
                    <!-- Tasks will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Wallet Page -->
        <div class="dashboard-content" id="dashboard-wallet" style="display: none;">
            <div style="padding: 20px;">
                <h3 style="margin-bottom: 20px;">üí≥ Wallet & Withdrawals</h3>
                
                <!-- Payment Method Binding -->
                <div class="wallet-card">
                    <h4>üîó Bind Payment Method</h4>
                    <div class="payment-methods">
                        <div class="payment-method" onclick="selectPaymentMethod('paypal')">
                            <i class="fab fa-paypal" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <div>PayPal</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod('binance')">
                            <i class="fas fa-wallet" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <div>Binance</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod('mpesa')">
                            <i class="fas fa-mobile-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <div>M-Pesa</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod('airtel')">
                            <i class="fas fa-sim-card" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <div>Airtel Money</div>
                        </div>
                    </div>
                    <div id="payment-details" style="margin-top: 20px; display: none;">
                        <div class="form-group">
                            <input type="text" class="form-control" id="payment-account" placeholder="Enter account details">
                        </div>
                        <button class="btn btn-primary" onclick="savePaymentMethod()">Save Payment Method</button>
                    </div>
                </div>

                <!-- Withdrawal History -->
                <div class="wallet-card">
                    <h4>Withdrawal History</h4>
                    <div id="withdrawal-history">
                        <p style="text-align: center; padding: 20px; color: var(--light-gray);">No withdrawal history yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Page -->
        <div class="dashboard-content" id="dashboard-profile" style="display: none;">
            <div style="padding: 20px;">
                <h3 style="margin-bottom: 20px;">üë§ Your Profile</h3>
                <div class="wallet-card">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" class="form-control" id="profile-name" readonly>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" id="profile-email" readonly>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" class="form-control" id="profile-phone" readonly>
                    </div>
                    <div class="form-group">
                        <label>Country</label>
                        <input type="text" class="form-control" id="profile-country" readonly>
                    </div>
                    <div class="form-group">
                        <label>Tier</label>
                        <input type="text" class="form-control" id="profile-tier" readonly>
                    </div>
                    <div class="form-group">
                        <label>Join Date</label>
                        <input type="text" class="form-control" id="profile-join-date" readonly>
                    </div>
                    <button class="btn btn-outline" style="width: 100%; margin-top: 15px;" onclick="showChangePINModal()">
                        Change Withdrawal PIN
                    </button>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <a href="#" class="nav-item active" onclick="showDashboardSection('home')">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" onclick="showDashboardSection('tasks')">
                <i class="fas fa-tasks"></i>
                <span>Tasks</span>
            </a>
            <a href="#" class="nav-item" onclick="showDashboardSection('wallet')">
                <i class="fas fa-wallet"></i>
                <span>Wallet</span>
            </a>
            <a href="#" class="nav-item" onclick="showDashboardSection('profile')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
        </div>
    </div>

    <!-- Admin Login -->
    <div id="admin-login-page" class="page form-container">
        <h2 class="form-title">Admin Login</h2>
        <div class="form-group">
            <input type="text" class="form-control" id="admin-username" placeholder="Admin Username" value="admin" required>
        </div>
        <div class="form-group">
            <input type="password" class="form-control" id="admin-password" placeholder="Admin Password" value="admin123" required>
        </div>
        <button class="btn btn-primary btn-3d" style="width: 100%;" onclick="loginAdmin()">Access Admin Panel</button>
        <p style="text-align: center; margin-top: 20px;">
            <a href="#" style="color: var(--primary-red);" onclick="showPage('landing-page')">‚Üê Back to Home</a>
        </p>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="page dashboard">
        <div class="top-bar">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div class="glassmorphism" style="width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.1rem;">A</div>
                <div>
                    <div style="font-weight: bold;">YSM Admin Panel</div>
                    <div style="font-size: 0.8rem; color: var(--light-gray);">Full System Access</div>
                </div>
            </div>
            <button class="btn btn-outline" onclick="logout()">Logout</button>
        </div>

        <div class="admin-panel">
            <h2 style="margin-bottom: 30px;">üëë Admin Dashboard</h2>
            
            <!-- Admin Navigation -->
            <div class="admin-nav">
                <button class="btn btn-primary" onclick="loadAdminStats()">Dashboard</button>
                <button class="btn btn-primary" onclick="loadKYCManagement()">KYC Management</button>
                <button class="btn btn-primary" onclick="loadUserManagement()">User Management</button>
                <button class="btn btn-primary" onclick="loadAdsManagement()">Ads Management</button>
                <button class="btn btn-primary" onclick="loadWithdrawalManagement()">Withdrawals</button>
                <button class="btn btn-primary" onclick="loadTierManagement()">Tier Settings</button>
            </div>
            
            <!-- Dashboard Stats -->
            <div id="admin-stats" class="admin-section admin-grid">
                <div class="admin-card">
                    <h3 style="color: var(--primary-red); margin-bottom: 15px;">üìä Platform Stats</h3>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--success);" id="total-users">0</div>
                    <div>Total Users</div>
                    <div style="margin-top: 15px; font-size: 1.5rem; font-weight: bold; color: var(--warning);" id="pending-kyc">0</div>
                    <div>Pending KYC</div>
                    <div style="margin-top: 15px; font-size: 1.5rem; font-weight: bold; color: var(--primary-red);" id="pending-withdrawals">0</div>
                    <div>Pending Withdrawals</div>
                </div>
                
                <div class="admin-card">
                    <h3 style="color: var(--primary-red); margin-bottom: 15px;">üí∞ Financial Overview</h3>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--success);" id="total-earnings">$0</div>
                    <div>Total Platform Earnings</div>
                    <div style="margin-top: 15px; font-size: 1.5rem; font-weight: bold; color: var(--warning);" id="total-withdrawals">$0</div>
                    <div>Total Withdrawals</div>
                </div>

                <div class="admin-card">
                    <h3 style="color: var(--primary-red); margin-bottom: 15px;">üìà Activity Graph</h3>
                    <div style="height: 200px; background: var(--black); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--light-gray);">
                        Ads Watched / Hour Graph
                    </div>
                </div>
            </div>

            <!-- KYC Management -->
            <div id="kyc-management" class="admin-section admin-card" style="display: none;">
                <h3 style="color: var(--primary-red); margin-bottom: 20px;">ü™™ KYC Management</h3>
                <div id="kyc-list">
                    <div style="text-align: center; padding: 40px; color: var(--light-gray);">
                        <div class="spinner"></div>
                        <p>Loading KYC requests...</p>
                    </div>
                </div>
            </div>

            <!-- User Management -->
            <div id="user-management" class="admin-section admin-card" style="display: none;">
                <h3 style="color: var(--primary-red); margin-bottom: 20px;">üë• User Management</h3>
                <div style="margin-bottom: 20px;">
                    <input type="text" class="form-control" id="user-search" placeholder="Search users...">
                </div>
                <div id="user-list">
                    <div style="text-align: center; padding: 40px; color: var(--light-gray);">
                        <div class="spinner"></div>
                        <p>Loading users...</p>
                    </div>
                </div>
            </div>

            <!-- Ads Management -->
            <div id="ads-management" class="admin-section admin-card" style="display: none;">
                <h3 style="color: var(--primary-red); margin-bottom: 20px;">üì∫ Ads Management</h3>
                <div class="form-group">
                    <label>Bulk Add YouTube Links (one per line)</label>
                    <textarea class="form-control" id="bulk-youtube-links" placeholder="Paste YouTube links here" rows="5"></textarea>
                </div>
                <button class="btn btn-primary" onclick="bulkAddVideos()">Add Videos as Tasks</button>
                
                <div style="margin-top: 30px;">
                    <h4>Current Active Tasks</h4>
                    <div id="ads-list">
                        <!-- Ads will be listed here -->
                    </div>
                </div>
            </div>

            <!-- Withdrawal Management -->
            <div id="withdrawal-management" class="admin-section admin-card" style="display: none;">
                <h3 style="color: var(--primary-red); margin-bottom: 20px;">üí∞ Withdrawal Management</h3>
                <div id="withdrawal-list">
                    <div style="text-align: center; padding: 40px; color: var(--light-gray);">
                        <div class="spinner"></div>
                        <p>Loading withdrawals...</p>
                    </div>
                </div>
            </div>

            <!-- Tier Management -->
            <div id="tier-management" class="admin-section admin-card" style="display: none;">
                <h3 style="color: var(--primary-red); margin-bottom: 20px;">üìä Tier Management</h3>
                <div class="tier-table-container" style="overflow-x: auto;">
                    <table class="tier-table">
                        <thead>
                            <tr>
                                <th>Tier</th>
                                <th>Ads/Day</th>
                                <th>Pay/Ad</th>
                                <th>Daily</th>
                                <th>Monthly</th>
                                <th>6-Month</th>
                                <th>1-Year</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tier-list">
                            <!-- Tiers will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div id="withdraw-modal" class="page form-container" style="display: none;">
        <h2 class="form-title">Withdraw Funds</h2>
        <div class="form-group">
            <label>Amount (Minimum: $5)</label>
            <input type="number" class="form-control" id="withdraw-amount" min="5" step="0.01" required>
        </div>
        <div class="form-group">
            <label>Payment Method</label>
            <select class="form-control" id="withdraw-method" required>
                <option value="">Select Method</option>
                <option value="paypal">PayPal</option>
                <option value="binance">Binance</option>
                <option value="mpesa">M-Pesa</option>
                <option value="airtel">Airtel Money</option>
            </select>
        </div>
        <div class="form-group">
            <label>Enter Your 6-Digit PIN</label>
            <div class="pin-container">
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this, 1)">
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this, 2)">
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this, 3)">
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this, 4)">
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this, 5)">
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this, 6)">
            </div>
        </div>
        <button class="btn btn-primary btn-3d" style="width: 100%;" onclick="submitWithdrawal()">
            Submit Withdrawal
        </button>
        <p style="text-align: center; margin-top: 20px;">
            <a href="#" style="color: var(--primary-red);" onclick="closeWithdrawModal()">
                ‚Üê Cancel
            </a>
        </p>
    </div>

    <!-- Change PIN Modal -->
    <div id="change-pin-modal" class="page form-container" style="display: none;">
        <h2 class="form-title">Change Withdrawal PIN</h2>
        <div class="form-group">
            <label>Current PIN</label>
            <div class="pin-container">
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this, 1)">
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this, 2)">
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this, 3)">
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this, 4)">
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this, 5)">
                <input type="password" class="pin-input" maxlength="1" oninput="moveToNext(this, 6)">
            </div>
        </div>
        <div class="form-group">
            <label>New PIN</label>
            <div class="pin-container">
                <input type="password" class="pin-input new-pin" maxlength="1" oninput="moveToNext(this, 1)">
                <input type="password" class="pin-input new-pin" maxlength="1" oninput="moveToNext(this, 2)">
                <input type="password" class="pin-input new-pin" maxlength="1" oninput="moveToNext(this, 3)">
                <input type="password" class="pin-input new-pin" maxlength="1" oninput="moveToNext(this, 4)">
                <input type="password" class="pin-input new-pin" maxlength="1" oninput="moveToNext(this, 5)">
                <input type="password" class="pin-input new-pin" maxlength="1" oninput="moveToNext(this, 6)">
            </div>
        </div>
        <button class="btn btn-primary btn-3d" style="width: 100%;" onclick="changePIN()">
            Change PIN
        </button>
        <p style="text-align: center; margin-top: 20px;">
            <a href="#" style="color: var(--primary-red);" onclick="closeChangePINModal()">
                ‚Üê Cancel
            </a>
        </p>
    </div>

    <!-- Chat Modal -->
    <div id="chat-modal" class="page form-container" style="display: none; max-width: 400px; height: 500px; display: flex; flex-direction: column;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 class="form-title" style="margin: 0;">üí¨ Support Chat</h2>
            <button class="btn btn-outline" style="padding: 5px 10px;" onclick="closeChat()">‚úï</button>
        </div>
        <div id="chat-messages" style="flex: 1; overflow-y: auto; margin-bottom: 15px; padding: 10px; background: var(--black); border-radius: 10px;">
            <div style="text-align: center; padding: 20px; color: var(--light-gray);">
                Start a conversation with our support team
            </div>
        </div>
        <div style="display: flex; gap: 10px;">
            <input type="text" class="form-control" id="chat-input" placeholder="Type your message...">
            <button class="btn btn-primary" onclick="sendChatMessage()">Send</button>
        </div>
    </div>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        const firebaseConfig = {
            apiKey: "AIzaSyDOKJQayF5j5xCp6LVZEEFFJH0QiQtezgg",
            authDomain: "ysm-platform-6ef20.firebaseapp.com",
            projectId: "ysm-platform-6ef20",
            storageBucket: "ysm-platform-6ef20.appspot.com",
            messagingSenderId: "485407332553",
            appId: "1:485407332553:web:77bd1bf2b3146486e51518"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        const db = firebase.firestore();
        const auth = firebase.auth();
        const storage = firebase.storage();

        // ==================== APPLICATION STATE ====================
        let currentUser = null;

        // Tier system configuration
        const tierSystem = {
            "115.38": { adsPerDay: 8, payPerAd: 0.48, daily: 3.85, monthly: 115.38, sixMonth: 692.31, oneYear: 1384.62 },
            "192.31": { adsPerDay: 10, payPerAd: 0.64, daily: 6.41, monthly: 192.31, sixMonth: 1153.85, oneYear: 2307.69 },
            "269.23": { adsPerDay: 12, payPerAd: 0.75, daily: 8.97, monthly: 269.23, sixMonth: 1615.38, oneYear: 3230.77 },
            "307.69": { adsPerDay: 13, payPerAd: 0.79, daily: 10.26, monthly: 307.69, sixMonth: 1846.15, oneYear: 3692.31 },
            "461.54": { adsPerDay: 15, payPerAd: 1.03, daily: 15.38, monthly: 461.54, sixMonth: 2769.23, oneYear: 5538.46 },
            "615.38": { adsPerDay: 17, payPerAd: 1.21, daily: 20.51, monthly: 615.38, sixMonth: 3692.31, oneYear: 7384.62 },
            "769.23": { adsPerDay: 18, payPerAd: 1.43, daily: 25.64, monthly: 769.23, sixMonth: 4615.38, oneYear: 9230.77 },
            "923.08": { adsPerDay: 20, payPerAd: 1.54, daily: 30.77, monthly: 923.08, sixMonth: 5538.46, oneYear: 11076.92 },
            "1692.31": { adsPerDay: 25, payPerAd: 2.26, daily: 56.41, monthly: 1692.31, sixMonth: 10153.85, oneYear: 20307.69 },
            "2461.54": { adsPerDay: 30, payPerAd: 2.74, daily: 82.05, monthly: 2461.54, sixMonth: 14769.23, oneYear: 29538.46 },
            "3230.77": { adsPerDay: 35, payPerAd: 3.08, daily: 107.69, monthly: 3230.77, sixMonth: 19384.62, oneYear: 38769.23 },
            "4000.00": { adsPerDay: 40, payPerAd: 3.33, daily: 133.33, monthly: 4000.00, sixMonth: 24000.00, oneYear: 48000.00 },
            "4615.38": { adsPerDay: 45, payPerAd: 3.42, daily: 153.85, monthly: 4615.38, sixMonth: 27692.31, oneYear: 55384.62 }
        };

        // ==================== FIXED AUTH STATE LISTENER ====================
        firebase.auth().onAuthStateChanged(async (user) => {
            try {
                if (user) {
                    const uid = user.uid;
                    const userRef = db.collection('users').doc(uid);
                    const doc = await userRef.get();
                    
                    if (!doc.exists) {
                        // Create user document if it doesn't exist
                        await userRef.set({ 
                            name: user.displayName || '', 
                            email: user.email || '', 
                            tier: '115.38', 
                            kycStatus: 'unverified', 
                            role: 'user', 
                            createdAt: new Date().toISOString(),
                            balance: 0,
                            pendingBalance: 0,
                            referralEarnings: 0,
                            dailyWatchCount: 0,
                            totalReferrals: 0,
                            referralCode: generateReferralCode(),
                            withdrawalPin: generatePIN()
                        });
                    }
                    
                    const freshDoc = await userRef.get();
                    const userData = freshDoc.exists ? freshDoc.data() : {};
                    
                    currentUser = { 
                        id: uid, 
                        name: userData.name || user.displayName || '', 
                        email: userData.email || user.email || '', 
                        tier: userData.tier || '115.38', 
                        kycStatus: userData.kycStatus || 'unverified', 
                        role: userData.role || 'user', 
                        balance: userData.balance || 0,
                        pendingBalance: userData.pendingBalance || 0,
                        referralEarnings: userData.referralEarnings || 0,
                        dailyWatchCount: userData.dailyWatchCount || 0,
                        totalReferrals: userData.totalReferrals || 0,
                        referralCode: userData.referralCode || '',
                        withdrawalPin: userData.withdrawalPin || '',
                        tierData: tierSystem[userData.tier] || tierSystem['115.38']
                    };
                    
                    // Route user based on role and KYC status
                    if (currentUser.role === 'admin') { 
                        showPage('admin-dashboard');
                        loadAdminStats();
                    } else {
                        if (currentUser.kycStatus === 'approved') { 
                            showPage('user-dashboard');
                            loadUserDashboard();
                        } else if (currentUser.kycStatus === 'pending') { 
                            showPage('kyc-pending-page');
                        } else { 
                            showPage('kyc-page');
                        }
                    }
                } else {
                    currentUser = null;
                    showPage('landing-page');
                }
            } catch (err) { 
                console.error('Auth state listener error:', err);
                showPage('landing-page');
            }
        });

        // ==================== FIXED UI FUNCTIONS ====================
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById(pageId).style.display = 'block';
            
            // Reset scroll position
            window.scrollTo(0, 0);
        }

        function showError(message) {
            alert('‚ùå ' + message);
        }

        function showSuccess(message) {
            alert('‚úÖ ' + message);
        }

        // ==================== FIXED AUTHENTICATION FUNCTIONS ====================
        async function registerUser() {
            try {
                const name = document.getElementById('reg-name')?.value?.trim();
                const email = document.getElementById('reg-email')?.value?.trim();
                const password = document.getElementById('reg-password')?.value;
                const phone = document.getElementById('reg-phone')?.value?.trim();
                const country = document.getElementById('reg-country')?.value;
                
                if (!name || !email || !password || !phone || !country) { 
                    alert('Please fill all fields'); 
                    return; 
                }
                
                showLoading();
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                if (!user) throw new Error('User creation failed');
                
                // Create user document in Firestore
                await db.collection('users').doc(user.uid).set({
                    name: name, 
                    email: email, 
                    phone: phone,
                    country: country,
                    tier: '115.38', 
                    kycStatus: 'unverified', 
                    role: 'user', 
                    balance: 0,
                    pendingBalance: 0,
                    referralEarnings: 0,
                    dailyWatchCount: 0,
                    totalReferrals: 0,
                    referralCode: generateReferralCode(),
                    withdrawalPin: generatePIN(),
                    createdAt: new Date().toISOString(),
                    canEarn: false
                });
                
                // Send email verification
                try { 
                    await user.sendEmailVerification(); 
                    alert('Verification email sent.'); 
                } catch (e) { 
                    console.warn('Email verification failed', e); 
                }
                
                alert('Account created successfully. Please complete KYC verification.');
                showPage('kyc-page');
            } catch (err) { 
                console.error('Registration error:', err);
                alert('Registration failed: ' + (err.message || err)); 
            } finally {
                hideLoading();
            }
        }

        async function loginUser() {
            try {
                const email = document.getElementById('login-email')?.value?.trim();
                const password = document.getElementById('login-password')?.value;
                
                if (!email || !password) { 
                    alert('Enter email & password'); 
                    return; 
                }
                
                showLoading();
                await firebase.auth().signInWithEmailAndPassword(email, password);
                // Auth state listener will handle redirection
            } catch (err) { 
                console.error('Login error:', err);
                alert('Login failed: ' + (err.message || err)); 
            } finally {
                hideLoading();
            }
        }

        async function logout() {
            try {
                await firebase.auth().signOut();
                showPage('landing-page');
                showSuccess('Signed out successfully');
            } catch (error) {
                console.error('Logout error:', error);
                showError('Logout failed');
            }
        }

        // ==================== FIXED KYC FUNCTIONS ====================
        async function submitKYC() {
            try {
                const name = document.getElementById('kyc-name')?.value?.trim();
                const idType = document.getElementById('kyc-id-type')?.value;
                const idNumber = document.getElementById('kyc-id-number')?.value?.trim();
                const front = document.getElementById('kyc-front')?.files?.[0];
                const back = document.getElementById('kyc-back')?.files?.[0];
                const selfie = document.getElementById('kyc-selfie')?.files?.[0];
                const address = document.getElementById('kyc-address')?.files?.[0];
                
                if (!name || !idType || !idNumber || !front || !back || !selfie || !address) { 
                    alert('Please complete KYC form and upload all required files'); 
                    return; 
                }
                
                const user = firebase.auth().currentUser;
                if (!user) { 
                    alert('Not authenticated. Please log in again.'); 
                    return; 
                }
                
                showLoading();
                
                // Upload files to Firebase Storage
                const frontRef = storage.ref(`user_uploads/${user.uid}/kyc-front-${Date.now()}-${front.name}`);
                const backRef = storage.ref(`user_uploads/${user.uid}/kyc-back-${Date.now()}-${back.name}`);
                const selfieRef = storage.ref(`user_uploads/${user.uid}/kyc-selfie-${Date.now()}-${selfie.name}`);
                const addressRef = storage.ref(`user_uploads/${user.uid}/kyc-address-${Date.now()}-${address.name}`);
                
                await frontRef.put(front);
                await backRef.put(back);
                await selfieRef.put(selfie);
                await addressRef.put(address);
                
                const frontUrl = await frontRef.getDownloadURL();
                const backUrl = await backRef.getDownloadURL();
                const selfieUrl = await selfieRef.getDownloadURL();
                const addressUrl = await addressRef.getDownloadURL();
                
                // Create KYC submission
                await db.collection('kycSubmissions').doc(user.uid).set({
                    userId: user.uid,
                    name: name,
                    idType: idType,
                    idNumber: idNumber,
                    frontImage: frontUrl,
                    backImage: backUrl,
                    selfieImage: selfieUrl,
                    addressImage: addressUrl,
                    status: 'pending',
                    submittedAt: new Date().toISOString()
                });
                
                // Update user KYC status
                await db.collection('users').doc(user.uid).update({ 
                    kycStatus: 'pending',
                    name: name
                });
                
                showSuccess('KYC submitted for review. Please wait for admin approval.');
                showPage('kyc-pending-page');
            } catch (err) { 
                console.error('KYC submission error:', err);
                alert('KYC submission failed: ' + (err.message || err)); 
            } finally {
                hideLoading();
            }
        }

        // ==================== FIXED ADMIN FUNCTIONS ====================
        async function loginAdmin() {
            try {
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;

                if (username === 'admin' && password === 'admin123') {
                    showLoading();
                    
                    // Try to sign in with admin credentials
                    try {
                        await auth.signInWithEmailAndPassword('admin@ysm.com', 'admin123');
                    } catch (error) {
                        // If admin user doesn't exist, create it
                        if (error.code === 'auth/user-not-found') {
                            const userCredential = await auth.createUserWithEmailAndPassword('admin@ysm.com', 'admin123');
                            const user = userCredential.user;
                            
                            // Create admin user document
                            await db.collection('users').doc(user.uid).set({
                                name: 'System Administrator',
                                email: 'admin@ysm.com',
                                role: 'admin',
                                kycStatus: 'approved',
                                tier: 'admin',
                                balance: 0,
                                createdAt: new Date().toISOString()
                            });
                        } else {
                            throw error;
                        }
                    }
                    
                    showSuccess('Admin login successful!');
                    showPage('admin-dashboard');
                    loadAdminStats();
                } else {
                    showError('Invalid admin credentials');
                }
            } catch (error) {
                console.error('Admin login error:', error);
                showError('Admin authentication failed: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function loadAdminStats() {
            showAdminSection('admin-stats');
            
            try {
                const usersSnapshot = await db.collection('users').get();
                document.getElementById('total-users').textContent = usersSnapshot.size;
                
                const kycSnapshot = await db.collection('kycSubmissions').where('status', '==', 'pending').get();
                document.getElementById('pending-kyc').textContent = kycSnapshot.size;
                
                const withdrawalsSnapshot = await db.collection('withdrawals').where('status', '==', 'pending').get();
                document.getElementById('pending-withdrawals').textContent = withdrawalsSnapshot.size;
                
                // Calculate totals
                let totalEarnings = 0;
                let totalWithdrawals = 0;
                
                usersSnapshot.forEach(doc => {
                    const user = doc.data();
                    totalEarnings += user.balance + (user.totalWithdrawn || 0);
                });
                
                const approvedWithdrawals = await db.collection('withdrawals').where('status', '==', 'approved').get();
                approvedWithdrawals.forEach(doc => {
                    totalWithdrawals += doc.data().amount;
                });
                
                document.getElementById('total-earnings').textContent = '$' + totalEarnings.toFixed(2);
                document.getElementById('total-withdrawals').textContent = '$' + totalWithdrawals.toFixed(2);
            } catch (error) {
                console.error('Error loading admin stats:', error);
                showError('Failed to load admin statistics');
            }
        }

        async function loadKYCManagement() {
            showAdminSection('kyc-management');
            const kycList = document.getElementById('kyc-list');
            
            try {
                const snapshot = await db.collection('kycSubmissions').where('status', '==', 'pending').get();
                
                if (snapshot.empty) {
                    kycList.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--light-gray);">No pending KYC requests</p>';
                    return;
                }

                let html = '';
                for (const doc of snapshot.docs) {
                    const kyc = doc.data();
                    const userDoc = await db.collection('users').doc(kyc.userId).get();
                    const user = userDoc.data();
                    
                    html += `
                        <div class="user-item">
                            <div>
                                <div style="font-weight: bold;">${kyc.name}</div>
                                <div style="font-size: 0.9rem; color: var(--light-gray);">
                                    ${user.email} ‚Ä¢ ${kyc.idType} ‚Ä¢ ${kyc.idNumber}
                                </div>
                                <div style="font-size: 0.8rem; color: var(--warning);">
                                    Submitted: ${new Date(kyc.submittedAt).toLocaleDateString()}
                                </div>
                            </div>
                            <div>
                                <button class="btn btn-success" onclick="approveKYC('${doc.id}')">Approve</button>
                                <button class="btn btn-danger" onclick="rejectKYC('${doc.id}')">Reject</button>
                            </div>
                        </div>
                    `;
                }
                
                kycList.innerHTML = html;
            } catch (error) {
                console.error('Error loading KYC management:', error);
                kycList.innerHTML = `<p style="color: var(--primary-red); text-align: center;">Error loading KYC: ${error.message}</p>`;
            }
        }

        async function approveKYC(kycId) {
            try {
                await db.collection('kycSubmissions').doc(kycId).update({
                    status: 'approved',
                    processedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                await db.collection('users').doc(kycId).update({
                    kycStatus: 'approved',
                    canEarn: true
                });

                showSuccess('KYC approved! User can now earn money.');
                loadKYCManagement();
                loadAdminStats();
            } catch (error) {
                console.error('Error approving KYC:', error);
                showError('Error approving KYC: ' + error.message);
            }
        }

        async function rejectKYC(kycId) {
            try {
                await db.collection('kycSubmissions').doc(kycId).update({
                    status: 'rejected',
                    processedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                await db.collection('users').doc(kycId).update({
                    kycStatus: 'rejected',
                    canEarn: false
                });

                showSuccess('KYC rejected! User must resubmit documents.');
                loadKYCManagement();
                loadAdminStats();
            } catch (error) {
                console.error('Error rejecting KYC:', error);
                showError('Error rejecting KYC: ' + error.message);
            }
        }

        async function loadUserManagement() {
            showAdminSection('user-management');
            const userList = document.getElementById('user-list');
            
            try {
                const snapshot = await db.collection('users').get();
                
                if (snapshot.empty) {
                    userList.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--light-gray);">No users found</p>';
                    return;
                }

                let html = '';
                snapshot.forEach(doc => {
                    const user = doc.data();
                    html += `
                        <div class="user-item">
                            <div>
                                <div style="font-weight: bold;">${user.name}</div>
                                <div style="font-size: 0.9rem; color: var(--light-gray);">
                                    ${user.email} ‚Ä¢ Tier: $${user.tier} ‚Ä¢ KYC: ${user.kycStatus}
                                </div>
                                <div style="font-size: 0.8rem; color: var(--warning);">
                                    Balance: $${user.balance || 0}
                                </div>
                            </div>
                            <div class="balance-control">
                                <input type="number" class="balance-input" id="balance-${doc.id}" value="${user.balance || 0}" step="0.01">
                                <button class="btn btn-primary" onclick="updateUserBalance('${doc.id}')">Update</button>
                            </div>
                        </div>
                    `;
                });
                
                userList.innerHTML = html;
            } catch (error) {
                console.error('Error loading user management:', error);
                userList.innerHTML = `<p style="color: var(--primary-red); text-align: center;">Error loading users: ${error.message}</p>`;
            }
        }

        async function updateUserBalance(userId) {
            try {
                const newBalance = parseFloat(document.getElementById(`balance-${userId}`).value);
                
                if (isNaN(newBalance)) {
                    showError('Please enter a valid balance');
                    return;
                }
                
                await db.collection('users').doc(userId).update({
                    balance: newBalance
                });
                
                showSuccess('User balance updated successfully');
            } catch (error) {
                console.error('Error updating user balance:', error);
                showError('Error updating balance: ' + error.message);
            }
        }

        async function loadAdsManagement() {
            showAdminSection('ads-management');
            
            try {
                // Load existing ads
                const snapshot = await db.collection('tasks').where('active', '==', true).get();
                const adsList = document.getElementById('ads-list');
                
                if (snapshot.empty) {
                    adsList.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--light-gray);">No active ads</p>';
                    return;
                }
                
                let html = '<div class="user-list">';
                snapshot.forEach(doc => {
                    const task = doc.data();
                    html += `
                        <div class="user-item">
                            <div>
                                <div style="font-weight: bold;">${task.title}</div>
                                <div style="font-size: 0.9rem; color: var(--light-gray);">
                                    Video ID: ${task.videoId} ‚Ä¢ Assigned Tiers: ${task.assignedTiers.join(', ')}
                                </div>
                            </div>
                            <div>
                                <button class="btn btn-danger" onclick="deactivateAd('${doc.id}')">Deactivate</button>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                
                adsList.innerHTML = html;
            } catch (error) {
                console.error('Error loading ads management:', error);
                showError('Failed to load ads management');
            }
        }

        async function deactivateAd(adId) {
            try {
                await db.collection('tasks').doc(adId).update({
                    active: false
                });
                
                showSuccess('Ad deactivated successfully');
                loadAdsManagement();
            } catch (error) {
                console.error('Error deactivating ad:', error);
                showError('Error deactivating ad: ' + error.message);
            }
        }

        async function bulkAddVideos() {
            try {
                const linksText = document.getElementById('bulk-youtube-links').value;
                if (!linksText.trim()) {
                    showError('Please enter YouTube links');
                    return;
                }
                
                const links = linksText.split('\n').filter(link => link.trim());
                let addedCount = 0;
                
                for (const link of links) {
                    const videoId = extractVideoId(link);
                    if (videoId) {
                        await db.collection('tasks').add({
                            videoId: videoId,
                            title: `YouTube Video ${videoId}`,
                            active: true,
                            assignedTiers: Object.keys(tierSystem),
                            createdAt: new Date().toISOString()
                        });
                        addedCount++;
                    }
                }
                
                showSuccess(`Added ${addedCount} videos as tasks`);
                document.getElementById('bulk-youtube-links').value = '';
                loadAdsManagement();
            } catch (error) {
                console.error('Error adding videos:', error);
                showError('Error adding videos: ' + error.message);
            }
        }

        function extractVideoId(url) {
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length === 11) ? match[7] : null;
        }

        async function loadWithdrawalManagement() {
            showAdminSection('withdrawal-management');
            const withdrawalList = document.getElementById('withdrawal-list');
            
            try {
                const snapshot = await db.collection('withdrawals').where('status', '==', 'pending').get();
                
                if (snapshot.empty) {
                    withdrawalList.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--light-gray);">No pending withdrawals</p>';
                    return;
                }

                let html = '';
                for (const doc of snapshot.docs) {
                    const withdrawal = doc.data();
                    const userDoc = await db.collection('users').doc(withdrawal.userId).get();
                    const user = userDoc.data();
                    
                    html += `
                        <div class="user-item">
                            <div>
                                <div style="font-weight: bold;">${user.name}</div>
                                <div style="font-size: 0.9rem; color: var(--light-gray);">
                                    ${user.email} ‚Ä¢ Amount: $${withdrawal.amount} ‚Ä¢ Method: ${withdrawal.method}
                                </div>
                                <div style="font-size: 0.8rem; color: var(--warning);">
                                    Requested: ${new Date(withdrawal.requestedAt).toLocaleDateString()}
                                </div>
                            </div>
                            <div>
                                <button class="btn btn-success" onclick="approveWithdrawal('${doc.id}')">Approve</button>
                                <button class="btn btn-danger" onclick="rejectWithdrawal('${doc.id}')">Reject</button>
                            </div>
                        </div>
                    `;
                }
                
                withdrawalList.innerHTML = html;
            } catch (error) {
                console.error('Error loading withdrawal management:', error);
                withdrawalList.innerHTML = `<p style="color: var(--primary-red); text-align: center;">Error loading withdrawals: ${error.message}</p>`;
            }
        }

        async function approveWithdrawal(withdrawalId) {
            try {
                const withdrawalDoc = await db.collection('withdrawals').doc(withdrawalId).get();
                const withdrawal = withdrawalDoc.data();
                
                // Update withdrawal status
                await db.collection('withdrawals').doc(withdrawalId).update({
                    status: 'approved',
                    processedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update user balance
                const userRef = db.collection('users').doc(withdrawal.userId);
                const userDoc = await userRef.get();
                const user = userDoc.data();
                
                await userRef.update({
                    balance: (user.balance || 0) - withdrawal.amount,
                    totalWithdrawn: (user.totalWithdrawn || 0) + withdrawal.amount
                });
                
                showSuccess('Withdrawal approved and processed');
                loadWithdrawalManagement();
                loadAdminStats();
            } catch (error) {
                console.error('Error approving withdrawal:', error);
                showError('Error approving withdrawal: ' + error.message);
            }
        }

        async function rejectWithdrawal(withdrawalId) {
            try {
                await db.collection('withdrawals').doc(withdrawalId).update({
                    status: 'rejected',
                    processedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showSuccess('Withdrawal rejected');
                loadWithdrawalManagement();
                loadAdminStats();
            } catch (error) {
                console.error('Error rejecting withdrawal:', error);
                showError('Error rejecting withdrawal: ' + error.message);
            }
        }

        async function loadTierManagement() {
            showAdminSection('tier-management');
            const tierList = document.getElementById('tier-list');
            
            try {
                let html = '';
                for (const [tier, data] of Object.entries(tierSystem)) {
                    html += `
                        <tr>
                            <td>$${tier}</td>
                            <td>${data.adsPerDay}</td>
                            <td>$${data.payPerAd}</td>
                            <td>$${data.daily}</td>
                            <td>$${data.monthly}</td>
                            <td>$${data.sixMonth}</td>
                            <td>$${data.oneYear}</td>
                        </tr>
                    `;
                }
                
                tierList.innerHTML = html;
            } catch (error) {
                console.error('Error loading tier management:', error);
                tierList.innerHTML = `<tr><td colspan="7" style="text-align: center; color: var(--primary-red);">Error loading tiers: ${error.message}</td></tr>`;
            }
        }

        function showAdminSection(sectionId) {
            document.querySelectorAll('.admin-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';
        }

        // ==================== FIXED USER DASHBOARD FUNCTIONS ====================
        async function loadUserDashboard() {
            if (!currentUser) return;
            
            try {
                // Update user data
                const userDoc = await db.collection('users').doc(currentUser.id).get();
                const userData = userDoc.data();
                
                currentUser = { ...currentUser, ...userData };
                
                // Update UI
                document.getElementById('user-display-name').textContent = currentUser.name;
                document.getElementById('user-tier-display').textContent = `$${currentUser.tier}`;
                document.getElementById('user-balance').textContent = `$${currentUser.balance?.toFixed(2) || '0.00'}`;
                document.getElementById('user-pending').textContent = `$${currentUser.pendingBalance?.toFixed(2) || '0.00'}`;
                document.getElementById('user-referral').textContent = `$${currentUser.referralEarnings?.toFixed(2) || '0.00'}`;
                document.getElementById('referral-count').textContent = currentUser.totalReferrals || 0;
                document.getElementById('referral-earnings').textContent = `$${currentUser.referralEarnings?.toFixed(2) || '0.00'}`;
                document.getElementById('referral-link').value = `${window.location.origin}?ref=${currentUser.referralCode}`;
                
                // Update KYC status
                const kycStatus = document.getElementById('kyc-status');
                kycStatus.textContent = currentUser.kycStatus;
                kycStatus.className = 'badge badge-' + currentUser.kycStatus;
                
                // Load tasks
                await loadTasks();
            } catch (error) {
                console.error('Error loading user dashboard:', error);
                showError('Failed to load dashboard data');
            }
        }

        async function loadTasks() {
            try {
                const tasksContainer = document.getElementById('tasks-container');
                const snapshot = await db.collection('tasks').where('active', '==', true).get();
                
                if (snapshot.empty) {
                    tasksContainer.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--light-gray);">No videos available at the moment. Please check back later.</p>';
                    return;
                }
                
                let html = '';
                snapshot.forEach(doc => {
                    const task = doc.data();
                    html += `
                        <div class="task-card">
                            <div class="video-container">
                                <iframe src="https://www.youtube.com/embed/${task.videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                            <h4>${task.title || 'YouTube Video'}</h4>
                            <p>Watch this video to earn money</p>
                            <button class="subscribe-btn" onclick="startTask('${doc.id}')">Watch & Earn</button>
                        </div>
                    `;
                });
                
                tasksContainer.innerHTML = html;
            } catch (error) {
                console.error('Error loading tasks:', error);
                document.getElementById('tasks-container').innerHTML = '<p style="text-align: center; padding: 40px; color: var(--primary-red);">Error loading videos</p>';
            }
        }

        function startTask(taskId) {
            // This would initialize the YouTube player and track watch time
            alert('Task started! Watch the video to earn money.');
            // Implementation would track video watch time and credit user when completed
        }

        // ==================== UTILITY FUNCTIONS ====================
        function generateReferralCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        function generatePIN() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        function copyReferralLink() {
            const link = document.getElementById('referral-link');
            link.select();
            document.execCommand('copy');
            showSuccess('Referral link copied to clipboard!');
        }

        function showDashboardSection(section) {
            document.querySelectorAll('.dashboard-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById('dashboard-' + section).style.display = 'block';
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function toggleNotifications() {
            const panel = document.getElementById('notifications-panel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function toggleChat() {
            const chatModal = document.getElementById('chat-modal');
            chatModal.style.display = chatModal.style.display === 'none' ? 'flex' : 'none';
        }

        function closeChat() {
            document.getElementById('chat-modal').style.display = 'none';
        }

        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (message) {
                const messages = document.getElementById('chat-messages');
                messages.innerHTML += `<div style="margin-bottom: 10px;"><strong>You:</strong> ${message}</div>`;
                input.value = '';
                messages.scrollTop = messages.scrollHeight;
            }
        }

        function showWithdrawModal() {
            document.getElementById('withdraw-modal').style.display = 'block';
        }

        function closeWithdrawModal() {
            document.getElementById('withdraw-modal').style.display = 'none';
        }

        function showChangePINModal() {
            document.getElementById('change-pin-modal').style.display = 'block';
        }

        function closeChangePINModal() {
            document.getElementById('change-pin-modal').style.display = 'none';
        }

        function moveToNext(input, nextIndex) {
            if (input.value.length === 1) {
                const inputs = input.parentElement.querySelectorAll('.pin-input');
                if (nextIndex < inputs.length) {
                    inputs[nextIndex].focus();
                }
            }
        }

        function verifyOTP() {
            showSuccess('OTP verified successfully!');
            showPage('kyc-page');
        }

        function resendOTP() {
            showSuccess('OTP resent to your email and phone');
        }

        function selectPaymentMethod(method) {
            document.querySelectorAll('.payment-method').forEach(pm => {
                pm.classList.remove('selected');
            });
            event.target.classList.add('selected');
            document.getElementById('payment-details').style.display = 'block';
        }

        function savePaymentMethod() {
            showSuccess('Payment method saved successfully!');
        }

        function submitWithdrawal() {
            showSuccess('Withdrawal request submitted!');
            closeWithdrawModal();
        }

        function changePIN() {
            showSuccess('PIN changed successfully!');
            closeChangePINModal();
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize file upload labels
            const mapping = {
                'kyc-front': 'front-file-name',
                'kyc-back': 'back-file-name',
                'kyc-selfie': 'selfie-file-name',
                'kyc-address': 'address-file-name'
            };
            
            Object.keys(mapping).forEach(function(inputId) {
                const inp = document.getElementById(inputId);
                const label = document.getElementById(mapping[inputId]);
                if (!inp) return;
                inp.addEventListener('change', function(e) {
                    const f = e.target.files && e.target.files[0];
                    if (f && label) label.textContent = f.name;
                });
            });
            
            console.log('YSM Platform initialized successfully');
        });

    </script>
</body>
</html>
