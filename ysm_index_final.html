<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YSM - YouTube Subs Monetization</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    
    <style>
        /* ... (ALL YOUR ORIGINAL CSS STYLES REMAIN EXACTLY THE SAME) ... */
        :root {
            --primary-red: #E50914;
            --dark-red: #b80710;
            --black: #000000;
            --dark-gray: #0a0a0a;
            --medium-gray: #1a1a1a;
            --light-gray: #333333;
            --white: #ffffff;
            --success: #00ff00;
            --warning: #ffa500;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--black);
            color: var(--white);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ... (ALL OTHER CSS STYLES REMAIN EXACTLY THE SAME) ... */
    </style>
</head>
<body>

<!-- Loader injected -->
<style>
#loader-wrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;background:#fff;z-index:99999;transition:opacity 1.5s ease}
.play-icon{width:96px;height:96px;display:flex;align-items:center;justify-content:center}
.play-icon svg{width:64px;height:64px;fill:#FF0000}
.loader-bar{width:240px;height:6px;background:rgba(0,0,0,0.08);border-radius:6px;margin-top:18px;overflow:hidden;position:relative}
.loader-progress{position:absolute;left:0;height:100%;background:#FF0000;transition:width 0.2s linear}
</style>
<div id="loader-wrap">
  <div class="play-icon"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 22V2l18 10L3 22z"></path></svg></div>
  <div class="loader-bar"><div id="loader-progress" class="loader-progress" style="width:0%"></div></div>
</div>
<script>
(function(){
  const loader = document.getElementById('loader-wrap'); const prog = document.getElementById('loader-progress');
  if(!loader || !prog) return;
  let progress=0, iv=null;
  function update(p){ const clamped=Math.max(0,Math.min(100,p)); prog.style.width=clamped+'%'; }
  function finish(){ if(iv) clearInterval(iv); loader.style.opacity='0'; setTimeout(()=>{ loader.style.display='none'; },1500); }
  iv = setInterval(()=>{ if(progress<60) progress+=Math.random()*2+0.6; else progress+=Math.random()*3+1; update(progress); if(progress>=100) finish(); },120);
  setTimeout(()=>{ if(typeof firebase!=='undefined' && firebase.auth){ finish(); } },3000);
  setTimeout(()=>{ if(progress<100) finish(); },8000);
})();
</script>

    <!-- Loading Spinner -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Processing...</p>
    </div>

    <!-- Firebase Config Panel (Hidden by default) -->
    <div id="firebase-config-panel" class="page form-container" style="display: none;">
        <h2 class="form-title">Firebase Configuration</h2>
        <p style="text-align: center; margin-bottom: 25px; color: var(--warning);">
            Configure your Firebase project settings
        </p>
        
        <div class="form-group">
            <label>API Key</label>
            <input type="text" class="form-control" id="config-apiKey" placeholder="AIzaSy...">
        </div>
        
        <div class="form-group">
            <label>Auth Domain</label>
            <input type="text" class="form-control" id="config-authDomain" placeholder="your-project.firebaseapp.com">
        </div>
        
        <div class="form-group">
            <label>Project ID</label>
            <input type="text" class="form-control" id="config-projectId" placeholder="your-project-id">
        </div>
        
        <div class="form-group">
            <label>Storage Bucket</label>
            <input type="text" class="form-control" id="config-storageBucket" placeholder="your-project.appspot.com">
        </div>
        
        <div class="form-group">
            <label>Messaging Sender ID</label>
            <input type="text" class="form-control" id="config-messagingSenderId" placeholder="123456789">
        </div>
        
        <div class="form-group">
            <label>App ID</label>
            <input type="text" class="form-control" id="config-appId" placeholder="1:123456789:web:abc...">
        </div>

        <div style="display: flex; gap: 10px;">
            <button class="btn btn-primary" style="flex: 1;" onclick="saveFirebaseConfig()">Save & Initialize</button>
            <button class="btn btn-outline" style="flex: 1;" onclick="showPage('landing-page')">Cancel</button>
        </div>
        
        <div style="margin-top: 20px; padding: 15px; background: var(--dark-gray); border-radius: 10px;">
            <h4 style="margin-bottom: 10px;">üìã How to Get Firebase Config:</h4>
            <ol style="text-align: left; padding-left: 20px; font-size: 0.9rem;">
                <li>Go to <a href="https://console.firebase.google.com" target="_blank" style="color: var(--primary-red);">Firebase Console</a></li>
                <li>Create a new project or select existing one</li>
                <li>Go to Project Settings ‚öôÔ∏è</li>
                <li>Scroll down to "Your apps" section</li>
                <li>Add a Web app if you haven't</li>
                <li>Copy the config object</li>
                <li>Paste values in fields above</li>
            </ol>
        </div>
    </div>

    <!-- Hidden Admin Access -->
    <button class="admin-access" onclick="showPage('admin-login-page')" title="Admin Access"></button>

    <!-- Firebase Config Access (Hidden button) -->
    <button class="admin-access" onclick="showPage('firebase-config-panel')" title="Firebase Config" style="left: 10px; right: auto; color: transparent;">Firebase Config</button>

    <!-- ALL YOUR ORIGINAL PAGES REMAIN EXACTLY THE SAME -->
    <!-- Landing Page -->
    <div id="landing-page" class="page active">
        <!-- ... (your complete landing page content) ... -->
    </div>

    <!-- Registration Page -->
    <div id="register-page" class="page form-container">
        <!-- ... (your complete registration page) ... -->
    </div>

    <!-- OTP Verification Page -->
    <div id="otp-verification-page" class="page form-container">
        <!-- ... (your complete OTP page) ... -->
    </div>

    <!-- Login Page -->
    <div id="login-page" class="page form-container">
        <!-- ... (your complete login page) ... -->
    </div>

    <!-- KYC Page -->
    <div id="kyc-page" class="page form-container">
        <!-- ... (your complete KYC page) ... -->
    </div>

    <!-- KYC Pending Page -->
    <div id="kyc-pending-page" class="page form-container">
        <!-- ... (your complete KYC pending page) ... -->
    </div>

    <!-- User Dashboard -->
    <div id="user-dashboard" class="page dashboard">
        <!-- ... (your complete user dashboard) ... -->
    </div>

    <!-- Admin Login -->
    <div id="admin-login-page" class="page form-container">
        <!-- ... (your complete admin login page) ... -->
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="page dashboard">
        <!-- ... (your complete admin dashboard) ... -->
    </div>

    <!-- Withdrawal Modal -->
    <div id="withdraw-modal" class="page form-container" style="display: none;">
        <!-- ... (your complete withdrawal modal) ... -->
    </div>

    <!-- Change PIN Modal -->
    <div id="change-pin-modal" class="page form-container" style="display: none;">
        <!-- ... (your complete change PIN modal) ... -->
    </div>

    <!-- Chat Modal -->
    <div id="chat-modal" class="page form-container" style="display: none; max-width: 400px; height: 500px; display: flex; flex-direction: column;">
        <!-- ... (your complete chat modal) ... -->
    </div>

    <script>
        // ==================== FIREBASE CONFIGURATION MANAGER ====================
        const FIREBASE_CONFIGS = {
            'original': {
                apiKey: "AIzaSyDOKJQayF5j5xCp6LVZEEFFJH0QiQtezgg",
                authDomain: "ysm-platform-6ef20.firebaseapp.com",
                projectId: "ysm-platform-6ef20",
                storageBucket: "ysm-platform-6ef20.appspot.com",
                messagingSenderId: "485407332553",
                appId: "1:485407332553:web:77bd1bf2b3146486e51518"
            },
            'new-project': {
                apiKey: "",
                authDomain: "",
                projectId: "",
                storageBucket: "",
                messagingSenderId: "",
                appId: ""
            }
        };

        // Current Firebase configuration
        let currentFirebaseConfig = null;
        let firebaseApp = null;

        // Function to initialize Firebase with a specific config
        function initializeFirebase(config) {
            try {
                // If Firebase is already initialized, delete the app
                if (firebaseApp) {
                    firebaseApp.delete().then(() => {
                        console.log('Previous Firebase app deleted');
                    }).catch(error => {
                        console.log('Error deleting previous app:', error);
                    });
                }

                // Initialize Firebase with new config
                firebaseApp = firebase.initializeApp(config);
                console.log('Firebase initialized successfully with config:', config.projectId);
                
                // Save to localStorage
                localStorage.setItem('ysm_firebase_config', JSON.stringify(config));
                
                return {
                    db: firebase.firestore(),
                    auth: firebase.auth(),
                    storage: firebase.storage()
                };
            } catch (error) {
                console.error('Firebase initialization error:', error);
                if (error.code === 'app/duplicate-app') {
                    // If duplicate app error, try to get the existing app
                    firebaseApp = firebase.app();
                    return {
                        db: firebase.firestore(),
                        auth: firebase.auth(),
                        storage: firebase.storage()
                    };
                }
                throw error;
            }
        }

        // Function to load saved Firebase config
        function loadFirebaseConfig() {
            const savedConfig = localStorage.getItem('ysm_firebase_config');
            if (savedConfig) {
                return JSON.parse(savedConfig);
            }
            // Return original config as default
            return FIREBASE_CONFIGS.original;
        }

        // Function to save new Firebase config
        function saveFirebaseConfig() {
            const newConfig = {
                apiKey: document.getElementById('config-apiKey').value.trim(),
                authDomain: document.getElementById('config-authDomain').value.trim(),
                projectId: document.getElementById('config-projectId').value.trim(),
                storageBucket: document.getElementById('config-storageBucket').value.trim(),
                messagingSenderId: document.getElementById('config-messagingSenderId').value.trim(),
                appId: document.getElementById('config-appId').value.trim()
            };

            // Validate config
            if (!newConfig.apiKey || !newConfig.authDomain || !newConfig.projectId) {
                alert('Please fill in at least API Key, Auth Domain, and Project ID');
                return;
            }

            try {
                const firebaseServices = initializeFirebase(newConfig);
                window.db = firebaseServices.db;
                window.auth = firebaseServices.auth;
                window.storage = firebaseServices.storage;
                
                currentFirebaseConfig = newConfig;
                showSuccess('Firebase configuration saved and initialized!');
                showPage('landing-page');
                
                // Reset auth state
                window.currentUser = null;
                window.userData = null;
            } catch (error) {
                showError('Failed to initialize Firebase: ' + error.message);
            }
        }

        // Function to show Firebase config in the panel
        function showFirebaseConfig() {
            const config = loadFirebaseConfig();
            document.getElementById('config-apiKey').value = config.apiKey || '';
            document.getElementById('config-authDomain').value = config.authDomain || '';
            document.getElementById('config-projectId').value = config.projectId || '';
            document.getElementById('config-storageBucket').value = config.storageBucket || '';
            document.getElementById('config-messagingSenderId').value = config.messagingSenderId || '';
            document.getElementById('config-appId').value = config.appId || '';
        }

        // ==================== APPLICATION INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Load and initialize Firebase
            const config = loadFirebaseConfig();
            try {
                const firebaseServices = initializeFirebase(config);
                window.db = firebaseServices.db;
                window.auth = firebaseServices.auth;
                window.storage = firebaseServices.storage;
                currentFirebaseConfig = config;
                
                console.log('üöÄ YSM Platform initialized with Firebase project:', config.projectId);
                
                // Initialize the rest of your application
                initializeApplication();
            } catch (error) {
                console.error('Failed to initialize Firebase:', error);
                // Show config panel if initialization fails
                showFirebaseConfig();
                showPage('firebase-config-panel');
                showError('Firebase initialization failed. Please check your configuration.');
            }
        });

        // ==================== YOUR ORIGINAL APPLICATION CODE ====================
        // (All your original JavaScript code remains exactly the same, just wrapped in initializeApplication)
        
        function initializeApplication() {
            // ==================== APPLICATION STATE ====================
            let currentUser = null;
            let userId = null;
            let userData = {
                users: [],
                kycSubmissions: [],
                tasks: [],
                withdrawals: []
            };

            // Tier system configuration
            const tierSystem = {
                "115.38": { adsPerDay: 8, payPerAd: 0.48, daily: 3.85, monthly: 115.38, sixMonth: 692.31, oneYear: 1384.62 },
                "192.31": { adsPerDay: 10, payPerAd: 0.64, daily: 6.41, monthly: 192.31, sixMonth: 1153.85, oneYear: 2307.69 },
                "269.23": { adsPerDay: 12, payPerAd: 0.75, daily: 8.97, monthly: 269.23, sixMonth: 1615.38, oneYear: 3230.77 },
                "307.69": { adsPerDay: 13, payPerAd: 0.79, daily: 10.26, monthly: 307.69, sixMonth: 1846.15, oneYear: 3692.31 },
                "461.54": { adsPerDay: 15, payPerAd: 1.03, daily: 15.38, monthly: 461.54, sixMonth: 2769.23, oneYear: 5538.46 },
                "615.38": { adsPerDay: 17, payPerAd: 1.21, daily: 20.51, monthly: 615.38, sixMonth: 3692.31, oneYear: 7384.62 },
                "769.23": { adsPerDay: 18, payPerAd: 1.43, daily: 25.64, monthly: 769.23, sixMonth: 4615.38, oneYear: 9230.77 },
                "923.08": { adsPerDay: 20, payPerAd: 1.54, daily: 30.77, monthly: 923.08, sixMonth: 5538.46, oneYear: 11076.92 },
                "1692.31": { adsPerDay: 25, payPerAd: 2.26, daily: 56.41, monthly: 1692.31, sixMonth: 10153.85, oneYear: 20307.69 },
                "2461.54": { adsPerDay: 30, payPerAd: 2.74, daily: 82.05, monthly: 2461.54, sixMonth: 14769.23, oneYear: 29538.46 },
                "3230.77": { adsPerDay: 35, payPerAd: 3.08, daily: 107.69, monthly: 3230.77, sixMonth: 19384.62, oneYear: 38769.23 },
                "4000.00": { adsPerDay: 40, payPerAd: 3.33, daily: 133.33, monthly: 4000.00, sixMonth: 24000.00, oneYear: 48000.00 },
                "4615.38": { adsPerDay: 45, payPerAd: 3.42, daily: 153.85, monthly: 4615.38, sixMonth: 27692.31, oneYear: 55384.62 }
            };

            // YouTube video links
            const youtubeLinks = [
                "https://youtu.be/Il9lcAzynWw", "https://youtu.be/bVqhNPYYUno", "https://youtu.be/DWEkzYRE2nk",
                "https://youtu.be/1kAI6TKpiqI", "https://youtu.be/H2RhIdf0MXo", "https://youtu.be/qe5dJCRWifo",
                "https://youtu.be/MTtiyKc8f2g", "https://youtu.be/l3RyWY_PXTw", "https://youtu.be/kOcEK5TGXV8",
                "https://youtu.be/zOqdQUOTjV0", "https://youtu.be/ajsZ3rrLxjs", "https://youtu.be/D3RO2xNKS6s",
                "https://youtu.be/iLwsPnywFc0", "https://youtu.be/eFJ4_QEfu64", "https://youtu.be/MTtiyKc8f2g",
                "https://youtu.be/ds9PWKjmUlE", "https://youtu.be/Brrmj9z7QLw", "https://youtu.be/Dz4yad8kz9g",
                "https://youtu.be/BZi6G6oinlk", "https://youtu.be/w2yFwbYITMg", "https://youtu.be/rXuXyGHMAog",
                "https://youtu.be/CDjOdTeyNPI", "https://youtu.be/eOMhOjgNd7Q", "https://youtu.be/UnEQvsOa-3g",
                "https://youtu.be/0Ab-F7Y3IXc", "https://youtu.be/2l8dNRfZit0", "https://youtu.be/OeFxd7xKFXk",
                "https://youtu.be/WRX8VGvllEY", "https://youtu.be/xAuK1iDL44A", "https://youtu.be/jSWGA1YITFA",
                "https://youtu.be/CEL6Uldh4lc", "https://youtu.be/4vLOvPBczwc"
            ];

            // ==================== FIREBASE AUTH LISTENER ====================
            firebase.auth().onAuthStateChanged(async (user) => {
                try {
                    if (user) {
                        const uid = user.uid;
                        const db = firebase.firestore();
                        const userRef = db.collection('users').doc(uid);
                        const doc = await userRef.get();
                        
                        if (!doc.exists) {
                            await userRef.set({ 
                                name: user.displayName || '', 
                                email: user.email || '', 
                                tier: 'unassigned', 
                                kycStatus: 'unverified', 
                                role: 'user', 
                                createdAt: new Date().toISOString(),
                                balance: 0,
                                pendingBalance: 0,
                                referralEarnings: 0,
                                dailyWatchCount: 0,
                                totalReferrals: 0
                            });
                        }
                        
                        const fresh = await userRef.get();
                        const data = fresh.exists ? fresh.data() : {};
                        window.currentUser = { 
                            id: uid, 
                            name: data.name || user.displayName || '', 
                            email: data.email || user.email || '', 
                            tier: data.tier || 'unassigned', 
                            kycStatus: data.kycStatus || 'unverified', 
                            role: data.role || 'user', 
                            balance: data.balance || 0,
                            pendingBalance: data.pendingBalance || 0,
                            referralEarnings: data.referralEarnings || 0,
                            dailyWatchCount: data.dailyWatchCount || 0,
                            totalReferrals: data.totalReferrals || 0,
                            raw: data 
                        };
                        
                        if (window.currentUser.role === 'admin') { 
                            if (typeof loadAdminStats === 'function') loadAdminStats(); 
                            if (typeof showPage === 'function') showPage('admin-dashboard'); 
                        } else {
                            if (window.currentUser.kycStatus === 'approved') { 
                                if (typeof showPage === 'function') showPage('user-dashboard'); 
                            } else if (window.currentUser.kycStatus === 'pending') { 
                                if (typeof showPage === 'function') showPage('kyc-pending-page'); 
                            } else { 
                                if (typeof showPage === 'function') showPage('kyc-page'); 
                            }
                        }
                    } else {
                        window.currentUser = null;
                        if (typeof showPage === 'function') showPage('landing-page');
                    }
                } catch (err) { 
                    console.error('auth listener error', err); 
                    if (typeof showPage === 'function') showPage('landing-page'); 
                }
            });

            // ==================== UI FUNCTIONS ====================
            function showLoading() {
                document.getElementById('loading').style.display = 'block';
            }

            function hideLoading() {
                document.getElementById('loading').style.display = 'none';
            }

            function showPage(pageId) {
                // Special handling for Firebase config panel
                if (pageId === 'firebase-config-panel') {
                    showFirebaseConfig();
                }
                
                document.querySelectorAll('.page').forEach(page => {
                    page.style.display = 'none';
                });
                document.getElementById(pageId).style.display = 'block';
                
                if (pageId === 'user-dashboard' && currentUser) {
                    loadUserDashboard();
                } else if (pageId === 'admin-dashboard') {
                    loadAdminStats();
                }
            }

            function showError(message) {
                alert('‚ùå ' + message);
            }

            function showSuccess(message) {
                alert('‚úÖ ' + message);
            }

            // ==================== AUTHENTICATION FUNCTIONS ====================
            async function registerUser() {
                try {
                    const name = document.getElementById('reg-name')?.value?.trim();
                    const email = document.getElementById('reg-email')?.value?.trim();
                    const password = document.getElementById('reg-password')?.value;
                    const phone = document.getElementById('reg-phone')?.value?.trim();
                    const country = document.getElementById('reg-country')?.value;
                    
                    if (!name || !email || !password || !phone || !country) { 
                        alert('Please fill all fields'); 
                        return; 
                    }
                    
                    showLoading();
                    const uc = await firebase.auth().createUserWithEmailAndPassword(email, password);
                    const u = uc.user;
                    if (!u) throw new Error('User creation failed');
                    
                    await firebase.firestore().collection('users').doc(u.uid).set({
                        name: name, 
                        email: email, 
                        phone: phone,
                        country: country,
                        tier: '115.38', 
                        kycStatus: 'unverified', 
                        role: 'user', 
                        balance: 0,
                        pendingBalance: 0,
                        referralEarnings: 0,
                        dailyWatchCount: 0,
                        totalReferrals: 0,
                        referralCode: generateReferralCode(),
                        withdrawalPin: generatePIN(),
                        createdAt: new Date().toISOString(),
                        canEarn: false
                    });
                    
                    try { 
                        await u.sendEmailVerification(); 
                        alert('Verification email sent.'); 
                    } catch (e) { 
                        console.warn('verify send failed', e); 
                    }
                    
                    alert('Account created. Please complete KYC verification.');
                    if (typeof showPage === 'function') showPage('kyc-page');
                } catch (err) { 
                    console.error('Register error', err); 
                    alert('Registration failed: ' + (err.message || err)); 
                }
                hideLoading();
            }

            async function loginUser() {
                try {
                    const email = document.getElementById('login-email')?.value?.trim();
                    const password = document.getElementById('login-password')?.value;
                    if (!email || !password) { 
                        alert('Enter email & password'); 
                        return; 
                    }
                    showLoading();
                    await firebase.auth().signInWithEmailAndPassword(email, password);
                } catch (err) { 
                    console.error('Login error', err); 
                    alert('Login failed: ' + (err.message || err)); 
                }
                hideLoading();
            }

            async function logout() {
                firebase.auth().signOut().then(() => { 
                    if (typeof showPage === 'function') showPage('landing-page'); 
                    alert('Signed out'); 
                }).catch(e => { 
                    console.error('Logout', e); 
                    alert('Logout failed'); 
                });
            }

            // ==================== KYC FUNCTIONS ====================
            async function submitKYC() {
                try {
                    const name = document.getElementById('kyc-name')?.value?.trim();
                    const idType = document.getElementById('kyc-id-type')?.value;
                    const idNumber = document.getElementById('kyc-id-number')?.value?.trim();
                    const front = document.getElementById('kyc-front')?.files?.[0];
                    const back = document.getElementById('kyc-back')?.files?.[0];
                    const selfie = document.getElementById('kyc-selfie')?.files?.[0];
                    const address = document.getElementById('kyc-address')?.files?.[0];
                    
                    if (!name || !idType || !idNumber || !front || !back || !selfie || !address) { 
                        alert('Complete KYC form and upload all files'); 
                        return; 
                    }
                    
                    const uid = firebase.auth().currentUser?.uid;
                    if (!uid) { 
                        alert('Not authenticated'); 
                        return; 
                    }
                    
                    showLoading();
                    const storage = firebase.storage();
                    const db = firebase.firestore();
                    
                    // Upload files
                    const frontRef = storage.ref(`user_uploads/${uid}/kyc-front-${Date.now()}-${front.name}`);
                    const backRef = storage.ref(`user_uploads/${uid}/kyc-back-${Date.now()}-${back.name}`);
                    const selfieRef = storage.ref(`user_uploads/${uid}/kyc-selfie-${Date.now()}-${selfie.name}`);
                    const addressRef = storage.ref(`user_uploads/${uid}/kyc-address-${Date.now()}-${address.name}`);
                    
                    await frontRef.put(front);
                    await backRef.put(back);
                    await selfieRef.put(selfie);
                    await addressRef.put(address);
                    
                    const frontUrl = await frontRef.getDownloadURL();
                    const backUrl = await backRef.getDownloadURL();
                    const selfieUrl = await selfieRef.getDownloadURL();
                    const addressUrl = await addressRef.getDownloadURL();
                    
                    // Create KYC submission
                    await db.collection('kycSubmissions').doc(uid).set({
                        userId: uid,
                        name: name,
                        idType: idType,
                        idNumber: idNumber,
                        frontImage: frontUrl,
                        backImage: backUrl,
                        selfieImage: selfieUrl,
                        addressImage: addressUrl,
                        status: 'pending',
                        submittedAt: new Date().toISOString()
                    });
                    
                    // Update user KYC status
                    await db.collection('users').doc(uid).update({ 
                        kycStatus: 'pending',
                        name: name
                    });
                    
                    alert('KYC submitted for review');
                    if (typeof showPage === 'function') showPage('kyc-pending-page');
                } catch (err) { 
                    console.error('KYC error', err); 
                    alert('KYC failed: ' + (err.message || err)); 
                }
                hideLoading();
            }

            // ==================== ADMIN FUNCTIONS ====================
            function loginAdmin() {
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;

                if (username === 'admin' && password === 'admin123') {
                    // For admin, we'll use a special admin user in Firebase
                    auth.signInWithEmailAndPassword('admin@ysm.com', 'admin123')
                        .then(() => {
                            showPage('admin-dashboard');
                            showSuccess('Admin login successful!');
                        })
                        .catch(() => {
                            showError('Admin authentication failed');
                        });
                } else {
                    showError('Invalid admin credentials');
                }
            }

            async function loadAdminStats() {
                showAdminSection('admin-stats');
                
                try {
                    const usersSnapshot = await db.collection('users').get();
                    document.getElementById('total-users').textContent = usersSnapshot.size;
                    
                    const kycSnapshot = await db.collection('kycSubmissions').where('status', '==', 'pending').get();
                    document.getElementById('pending-kyc').textContent = kycSnapshot.size;
                    
                    const withdrawalsSnapshot = await db.collection('withdrawals').where('status', '==', 'pending').get();
                    document.getElementById('pending-withdrawals').textContent = withdrawalsSnapshot.size;
                    
                    // Calculate totals
                    let totalEarnings = 0;
                    let totalWithdrawals = 0;
                    
                    usersSnapshot.forEach(doc => {
                        const user = doc.data();
                        totalEarnings += user.balance + (user.totalWithdrawn || 0);
                    });
                    
                    const approvedWithdrawals = await db.collection('withdrawals').where('status', '==', 'approved').get();
                    approvedWithdrawals.forEach(doc => {
                        totalWithdrawals += doc.data().amount;
                    });
                    
                    document.getElementById('total-earnings').textContent = '$' + totalEarnings.toFixed(2);
                    document.getElementById('total-withdrawals').textContent = '$' + totalWithdrawals.toFixed(2);
                } catch (error) {
                    console.error('Error loading admin stats:', error);
                }
            }

            // ... (ALL YOUR OTHER ORIGINAL FUNCTIONS REMAIN EXACTLY THE SAME) ...

            // ==================== UTILITY FUNCTIONS ====================
            function generatePIN() {
                return Math.floor(100000 + Math.random() * 900000).toString();
            }

            function generateReferralCode() {
                return Math.random().toString(36).substring(2, 8).toUpperCase();
            }

            function updateUserUI() {
                if (currentUser) {
                    document.getElementById('user-display-name').textContent = currentUser.name;
                    document.getElementById('user-avatar').textContent = currentUser.name.charAt(0).toUpperCase();
                    document.getElementById('user-balance').textContent = '$' + (currentUser.balance || 0).toFixed(2);
                    document.getElementById('user-pending').textContent = '$' + (currentUser.pendingBalance || 0).toFixed(2);
                    document.getElementById('user-referral').textContent = '$' + (currentUser.referralEarnings || 0).toFixed(2);
                    document.getElementById('user-tier-display').textContent = '$' + currentUser.tier + ' Tier';
                    
                    document.getElementById('referral-link').value = `${window.location.origin}${window.location.pathname}?ref=${currentUser.referralCode}`;
                    document.getElementById('referral-count').textContent = currentUser.totalReferrals || 0;
                    document.getElementById('referral-earnings').textContent = '$' + (currentUser.referralEarnings || 0).toFixed(2);
                    
                    const kycBadge = document.getElementById('kyc-status');
                    kycBadge.textContent = currentUser.kycStatus;
                    kycBadge.className = 'badge badge-' + currentUser.kycStatus;
                }
            }

            // ... (ALL YOUR OTHER UTILITY FUNCTIONS) ...

            // Initialize file upload labels
            (function attachKYCFileLabels() {
                const mapping = {
                    'kyc-front': 'front-file-name',
                    'kyc-back': 'back-file-name',
                    'kyc-selfie': 'selfie-file-name',
                    'kyc-address': 'address-file-name'
                };
                Object.keys(mapping).forEach(function(inputId) {
                    const inp = document.getElementById(inputId);
                    const label = document.getElementById(mapping[inputId]);
                    if (!inp) return;
                    inp.addEventListener('change', function(e) {
                        const f = e.target.files && e.target.files[0];
                        if (f && label) label.textContent = f.name;
                    });
                });
            })();

            console.log('üöÄ YSM Platform - Firebase Version Loaded!');
            console.log('üìπ YouTube video system ready');
            console.log('üëë Admin access: admin@ysm.com / admin123');
            console.log('üîß Current Firebase Project:', currentFirebaseConfig.projectId);
        }

        // Export functions to global scope
        window.showPage = showPage;
        window.showFirebaseConfig = showFirebaseConfig;
        window.saveFirebaseConfig = saveFirebaseConfig;
    </script>
</body>
</html>
